{% extends "snippets/base.html" %}

{% block head %}
<script type="text/javascript" src="{{ STATIC_URL }}masonry.pkgd.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}imagesloaded.pkgd.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}infinite-scroll.js"></script>
{% endblock %}

{% block content %}

    {% if latest_snippet_list %}      
        <div id="snippetcontainer">
            {% for snippet in latest_snippet_list %}
                <a href="/snippets/view/{{ snippet.id }}/">

                    <div class="snippetbox {{ snippet.width }}">
                        {% if snippet.media != "" %}
                            {% if snippet.mediaType == "0" %}
                                <img src='{{ snippet.media }}'>
                            {% else %}
                                {%if snippet.mediaType == "1" %}
                                <img src='{{ snippet.media }}'>
                                {% else %}
                                    {%if snippet.mediaType == "2" %}
                                        <iframe src="http://www.youtube.com/embed/{{ snippet.media }}?html5=1&autohide=1" width="520" height="310" frameborder="0" allowfullscreen></iframe>                          
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endif %}    

                        {% if snippet.title != '' or snippet.text != '' %}
                            <div class="snippettext">
                                {% if snippet.title != ''%}
                                    <h3>{{ snippet.title }}</h3>
                                {% endif %}

                                {% if snippet.text != ''%}
                                    {{ snippet.text|linebreaks }}
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </a>
            {% endfor %}
        </div>
        
    {% else %}
        <p>No snippets are available.</p>
    {% endif %}

    <nav id="page-nav">
        <a href="./{{ nextpage }}/"></a>
    </nav>



    <script>
        $(function(){
            
            var $container = $('#snippetcontainer');
            
            $container.imagesLoaded(function(){
              $container.masonry({
                itemSelector: '.snippetbox',
                columnWidth: 270,
                isFitWidth: true
              });
            });
            
            $container.infinitescroll({
              navSelector  : '#page-nav',    // selector for the paged navigation 
              nextSelector : '#page-nav a',  // selector for the NEXT link (to page 2)
              itemSelector : '.snippetbox',     // selector for all items you'll retrieve
              bufferPx: 500,
              loading: {
                  finishedMsg: 'No more pages to load.',
                  img: 'http://i.imgur.com/6RMhx.gif'
                }
              },
              // trigger Masonry as a callback
              function( newElements ) {
                // hide new items while they are loading
                var $newElems = $( newElements ).css({ opacity: 0 });
                // ensure that images load before adding to masonry layout
                $newElems.imagesLoaded(function(){
                  // show elems now they're ready
                  $newElems.animate({ opacity: 1 });
                  $container.masonry( 'appended', $newElems, true ); 
                });
              }
            );
            
        });
    </script>


{% endblock %}
